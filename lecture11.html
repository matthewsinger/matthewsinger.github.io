<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Lecture 11: big-bang</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="extra-styles.css" title="default"/><link rel="stylesheet" type="text/css" href="ps-styles.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="extra-scripts.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.3</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="lecture10.html" title="backward to &quot;Lecture 10: Intervals&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Lectures.html" title="up to &quot;II Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="lecture12.html" title="forward to &quot;Lecture 12: Structures&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3><a name="(part._lecture11)"></a>Lecture 11: big-bang</h3><p><span style="font-weight: bold">Motivation:</span> We want to use our data definitions to drive our programs.</p><p><span style="font-weight: bold">Topics to cover:</span> <span class="RktSym">big-bang</span>, <span class="RktSym">to-draw</span>, <span class="RktSym">on-tick</span>, <span class="RktSym">stop-when</span></p><h4><a name="(part._g7462)"></a>Recap</h4><p>Any insights from the homework? What didn&rsquo;t people understand?</p><h4><a name="(part._g7463)"></a>Traffic light</h4><p>Let&rsquo;s come up with a data definition for a traffic light.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">A TrafficLight is one of:</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">- </span><span class="RktCmt">'</span><span class="RktCmt">red</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">- </span><span class="RktCmt">'</span><span class="RktCmt">yellow</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">- </span><span class="RktCmt">'</span><span class="RktCmt">green</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">and represents a traffic light color</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-red</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">red</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-yellow</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">yellow</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-green</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">green</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">tl-temp : TrafficLight -&gt; ?</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">tl-temp</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cond</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">symbol=?</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-red</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">symbol=?</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-yellow</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">symbol=?</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-green</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Now if we wanted to make a traffic light antimation using this data definition,
how would we do it? (hold discussion)</p><p>In the end, we&rsquo;d need to convert natural numbers to traffic lights via <span class="RktSym">remainder</span>,
but that&rsquo;s not very satisfying. Enter <span class="RktSym">big-bang</span>.</p><h4><a name="(part._g7464)"></a>big-bang</h4><p><span class="RktSym">big-bang</span> is the second piece of magic we&rsquo;re going to work with, and it&rsquo;s
much more powerful than <span class="RktSym">animate</span>. With <span class="RktSym">big-bang</span>, we can not only build
animtations, but interactive programs. Let&rsquo;s see what the syntax looks like.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">big-bang</span><span class="hspace">&nbsp;</span><span class="RktSym">world0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">to-draw</span><span class="hspace">&nbsp;</span><span class="RktSym">drawing-function</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">handler1</span><span class="hspace">&nbsp;</span><span class="RktSym">handler1-function</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">handler2</span><span class="hspace">&nbsp;</span><span class="RktSym">handler2-function</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">handlern</span><span class="hspace">&nbsp;</span><span class="RktSym">handlern-function</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote><p><span class="RktSym">big-bang</span> is always given an initial "world state" and must have a function
that tells it how to draw. What the handlers are are specific to each program,
but there are rules about what they can be. All handlers take the current world state
(and possibly more data) and produce a new world state. The function given to the
<span class="RktSym">to-draw</span> handler draws the program after every update from any handler.</p><p>Let&rsquo;s write our first <span class="RktSym">big-bang</span> program which will animate a traffic light for us.
First, we know we&rsquo;re going to need a function to draw a traffic light, so let&rsquo;s do that.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">empty-scene</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">LIGHT-RADIUS</span><span class="hspace">&nbsp;</span><span class="RktVal">25</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">draw-tl : TrafficLight -&gt; Image</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">draw the traffic light</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">draw-tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">overlay</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">LIGHT-RADIUS</span><span class="hspace">&nbsp;</span><span class="RktVal">"solid"</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">check-expect</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">draw-tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-red</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">overlay</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktSym">LIGHT-RADIUS</span><span class="hspace">&nbsp;</span><span class="RktVal">"solid"</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">red</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Now we&rsquo;re going to introduce a <span class="RktSym">big-bang</span> handler we&rsquo;re going to use a lot:
<span class="RktSym">on-tick</span>. The function given to the <span class="RktSym">on-tick</span> handler must take in
the current world state and produce the next one after one tick has passed. We&rsquo;ll define
what "one tick" means soon, but for now, let&rsquo;s design a function that given a current
traffic light, produces the next one.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">next-tl : TrafficLight -&gt; TrafficLight</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">The next traffic light</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">next-tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cond</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">symbol=?</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-red</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-green</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">symbol=?</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-yellow</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-red</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">symbol=?</span><span class="hspace">&nbsp;</span><span class="RktSym">tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-green</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-yellow</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">check-expect</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">next-tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-red</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-green</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">check-expect</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">next-tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-yellow</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-red</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">check-expect</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">next-tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-green</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-yellow</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Now we can combine this into a <span class="RktSym">big-bang</span> program.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">big-bang</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-green</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">to-draw</span><span class="hspace">&nbsp;</span><span class="RktSym">draw-tl</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">on-tick</span><span class="hspace">&nbsp;</span><span class="RktSym">next-tl</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Wow! That was cool but way too fast. <span class="RktSym">on-tick</span>, by default, moves at <span class="RktVal">1/28</span> seconds
per frame. We can give <span class="RktSym">on-tick</span> a rate in seconds per frame as a second argument to
slow it down, as in:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">big-bang</span><span class="hspace">&nbsp;</span><span class="RktSym">tl-green</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">to-draw</span><span class="hspace">&nbsp;</span><span class="RktSym">draw-tl</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">on-tick</span><span class="hspace">&nbsp;</span><span class="RktSym">next-tl</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote><p>That&rsquo;s better. That moves at <span class="RktVal">1</span> second per frame. The bigger the number, the slower the speed.</p><p>Notice what is shown in the interactions window: a traffic light. Specifically, the last traffic light.
<span class="RktSym">big-bang</span> always returns the last world state before it exits.</p><p>So this is fine, but it&rsquo;s bad style to just leave this <span class="RktSym">big-bang</span> expression at the bottom
of our program and have it go whenever we press "run". We should always wrap our call to <span class="RktSym">big-bang</span>
in a <span class="RktSym">main</span> function.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">run-tl : TrafficLight -&gt; TrafficLight</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">run the traffic light animation</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">run-tl</span><span class="hspace">&nbsp;</span><span class="RktSym">tl0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">big-bang</span><span class="hspace">&nbsp;</span><span class="RktSym">tl0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">to-draw</span><span class="hspace">&nbsp;</span><span class="RktSym">draw-tl</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">on-tick</span><span class="hspace">&nbsp;</span><span class="RktSym">next-tl</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Now we can call this from the interactions window, and specify an initial traffic light color.</p><p>Notice that we cannot test <span class="RktSym">run-tl</span>, since any test would launch <span class="RktSym">big-bang</span>,
and we don&rsquo;t want to do that, and we also don&rsquo;t know when our program will end,
so we can&rsquo;t predict the final outcome. We can and do test our handlers to compensate.</p><p>So let&rsquo;s start formalizing the notion of these handlers. We will say that <span class="RktSym">big-bang</span>
always operates over some kind of WorldState, but what that WorldState is changes
from program to program. The rules for the handlers, given a WorldState, stays the same,
though. What are the rules for the functions given to <span class="RktSym">to-draw</span> and <span class="RktSym">on-tick</span>,
and what are their general purpose statements?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">to-draw-function : WorldState -&gt; Image</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Draw the world state</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">on-tick-function : WorldState -&gt; WorldState</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Advance the world state by one tick</span></td></tr></table></blockquote><p>Within a few classes we&rsquo;ll quickly grow the number of handlers we can use.</p><h4><a name="(part._g7465)"></a>Animations we&rsquo;re used to</h4><p>Let&rsquo;s do an animation we&rsquo;re accustomed to in the format of <span class="RktSym">big-bang</span>, by moving
a dot across a screen.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">DOT</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">"outline"</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">dot-animation : Nat -&gt; Nat</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Given a dot</span><span class="RktCmt">'</span><span class="RktCmt">s initial x-coord, move to the right of BG</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dot-animation</span><span class="hspace">&nbsp;</span><span class="RktSym">x0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">big-bang</span><span class="hspace">&nbsp;</span><span class="RktSym">x0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">to-draw</span><span class="hspace">&nbsp;</span><span class="RktSym">place-at-x</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">on-tick</span><span class="hspace">&nbsp;</span><span class="RktSym">add1</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">place-at-x : Nat -&gt; Image</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Draw DOT at x on BG</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">place-at-x</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">place-image</span><span class="hspace">&nbsp;</span><span class="RktSym">DOT</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">/</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">image-height</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">check-expect</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">place-at-x</span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">place-image</span><span class="hspace">&nbsp;</span><span class="RktSym">DOT</span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">/</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">image-height</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>So this is great, but let&rsquo;s say we want to stop the animation once it&rsquo;s past the screen.
The last handler we&rsquo;ll introduce today is <span class="RktSym">stop-when</span>, which takes our world
state and outputs whether or not the world should stop.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">DOT</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">circle</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">"outline"</span><span class="hspace">&nbsp;</span><span class="RktVal">"blue"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">dot-animation : Nat -&gt; Nat</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Given a dot</span><span class="RktCmt">'</span><span class="RktCmt">s initial x-coord, move to the right of BG</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dot-animation</span><span class="hspace">&nbsp;</span><span class="RktSym">x0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">big-bang</span><span class="hspace">&nbsp;</span><span class="RktSym">x0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">to-draw</span><span class="hspace">&nbsp;</span><span class="RktSym">place-at-x</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">on-tick</span><span class="hspace">&nbsp;</span><span class="RktSym">add1</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">stop-when</span><span class="hspace">&nbsp;</span><span class="RktSym">at-end?</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">place-at-x : Nat -&gt; Image</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Draw DOT at x on BG</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">place-at-x</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">place-image</span><span class="hspace">&nbsp;</span><span class="RktSym">DOT</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">/</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">image-height</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">check-expect</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">place-at-x</span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">place-image</span><span class="hspace">&nbsp;</span><span class="RktSym">DOT</span><span class="hspace">&nbsp;</span><span class="RktVal">20</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">/</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">image-height</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">at-end? : Nat -&gt; Boolean</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Is this at at the end of the screen?</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">at-end?</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&gt;=</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">image-width</span><span class="hspace">&nbsp;</span><span class="RktSym">BG</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">check-expect</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">at-end?</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">check-expect</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">at-end?</span><span class="hspace">&nbsp;</span><span class="RktVal">1000</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Now we see that the program stops. So, to recap on the handlers we know about:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">to-draw-function : WorldState -&gt; Image</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Draw the world state</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">on-tick-function : WorldState -&gt; WorldState</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Advance the world state by one tick</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">stop-when-function : WorldState -&gt; Boolean</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Should the program stop?</span></td></tr></table></blockquote><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="lecture10.html" title="backward to &quot;Lecture 10: Intervals&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Lectures.html" title="up to &quot;II Lectures&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="lecture12.html" title="forward to &quot;Lecture 12: Structures&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>